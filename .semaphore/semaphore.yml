version: v1.0
name: Zephyr
agent:
  machine:
    type: e1-standard-8
    os_image: ubuntu1804
  containers:
    - name: main
      image: 'zephyrprojectrtos/ci:v0.9'
blocks:
  - name: Hello
    task:
      jobs:
        - name: Hello
          parallelism: 20
          commands:
            - apt-get install lftp
            - checkout --use-cache
            - source zephyr-env.sh
            - west init
            - west update
            - >-
              scripts/sanitycheck -p frdm_k64f --subset
              $SEMAPHORE_JOB_INDEX/$SEMAPHORE_JOB_COUNT --inline-logs -v -v
      env_vars:
        - name: ZEPHYR_SDK_INSTALL_DIR
          value: /opt/sdk/zephyr-sdk-0.10.3
        - name: ZEPHYR_TOOLCHAIN_VARIANT
          value: zephyr
